\kapitola{Implementace aplikace}

\sekce{Použitý software}
\podsekce{Qt}
Qt je multiplatformní knihovna pro c++ umožnující nejen tvorbu grafických aplikací, ale i práci se soubory, obrázky či sítovým připojením.
Byla nedílnou součástí vyvíjené aplikace.
Knihovna podporuje běh samotného jádra aplikace -- načítání webových souborů a také se stará o~grafické zobrazování dat.
Její funkce jsou tedy použité při většině výpočtů aplikace.
\podsekce{Qt Creator}
Qt Creator je vývojové prostředí určené primárně pro vývoj aplikací využívajících knihovny Qt.
Programátorovi nabízí zvýrazňování syntaxe a doplňování názvů.
Umožňuje také kompilování, spouštění a debugování aplikace pomocí jednoduše ovladatelných nástrojů.
Dále také umožňuje ovládání gitu pomocí zabudovaných nástrojů.
V~tomto prostředí vznikla většina zdrojových kódů aplikace.
\obr{qtcreator}{Vývojové prostředí Qt Creator}
\podsekce{Git}
Git je systém na správu verzí využitý při vývoji této aplikace.
Umožňuje oddělení jednotlivých úkonů při vývoji, jejich zdokumentování a možnost zobrazení jejich historie.
Dále nabízí pomocí vzdálených repositářů jednoduchý způsob, jak aplikaci nahrát na web a zpřístupnit uživatelům.

\sekce{Objektový model, rozdělení problému}
	Samotná knihovna Qt je psaná objektově, a proto je vhodné navázat v~objektové orientovaném programování i při vývoji.
	Program jsem tedy rozčlenil do několika vzájemně provázaných tříd.
	Pro každou třídu existují dva soubory obsahující hlavičky a samotný program.

	Program jsem dále rozčlenil na téměř samostatné části.
	Třídy pozadí se starají o~samotné načítání a zjišťování rozdílů na stránkách, práci s~databází a porovnávání verzí stránek.
	Ostatní třídy se starají o~správné předávání dat uživateli pomocí graficky vykreslených oken a také přijímají pokyny od uživatele a propagují je do příslušných tříd.
	Díky tomu je možné poměrně jednoduše přepsat celé uživatelské rozhraní například do podoby konzolové aplikace s~využitím stávájících funkcí pozadí.


\sekce{Pozadí aplikace}
Hlavní třídou aplikace je \c|Background|. Ta se stará o~inicializaci a propojení ostatních tříd pozadí.
Dále si také ukládá a načítá seznam stránek na kontrolu.

Třída \c|ConnectionThread| se stará o~samotné načítání a hledání rozdílů ve stránkách. Aby byl zajištěn hladký chod aplikace, je tato část programu vykonávána jako speciální vlákno. % TODO přejmenovat to
Díky tomu lze při načítání libovolně pracovat s~aplikací.
V~této třídě je také implementováno ignorování částí změn na základě zadaných podmínek.

Pro usnadnění přístupu do databáze slouží třída \c|Database|.
Ta přistupuje do souboru \c|database.db| % TODO přejmenovat to.
pomocí knihovny SQLite.
V~databázi jsou uloženy záznamy o~všech verzích stránek a také uživatelské nastavení.

O~ukládání nových změn na stránce se stará \c|NewPageModel|. Tento tabulkový model je pak přímo napojen na zobrazování změn.

Třída \c|PageQuery| založená na \c|NewPageModel| obsahuje tabulky dotazu z~databáze na historii změn.

\podsekce{Porovnávání verzí stránek}
\c|PageComparator| umožňuje porovnávání verzí stránek.
Jeho úkolem je najít nejlepší napojení stránek na sebe a následné vytvoření souborů, které zobrazují změny v~prohlížeči.

Obě dvě verze stránky si rozdělí na jednotlivá slova a tagy. S~nimi se dále pracuje jako se znaky.
Poté hledá nejdelší shodný podřetězec.
Na to využívá dynamického programování.
Pro každou dvojici prefixů z~obou řetězců si spočítá délku nejdelšího shodného podřetězce.
K~výpočtu ovšem využívá toho, že tuto hodnotu již zná pro kratší prefixy.
Když je poslední slovo v~obou prefixech stejné, tak oproti dvojici, v~niž jsou oba prefixy o~jedno slovo kratší, může být délka podřetězce o~jedna delší (toto odpovídá variantě, že poslední slovo přibude ve shodném podřetězci).
Délka podřetězce ovšem může být stejná jako délka podřetězce ve dvojicích, které mají jeden sufix o~jedna kratší (toto odpovídá variantě, že shodný podřetězec zůstane stejný).
Z~těchto variant vybere maximum.

Poté již není problém zrekonstruovat tvar podřetězce.
Stačí projít takto vytvořenou tabulku od prefixů obsahujících celé řetězce směrem odkud vzniklo maximum v~dané buňce.

Při tomto průchodu si poznačí, které části vstupu jsou součástí shodného podřetězce a které nikoliv.
Části, které nejsou součástí podřetězce pak zobrazuje jako změny, tedy je barevně zvýrazní obalením do tagu \c|span|.




\sekce{Grafické uživatelské rozhraní}
Hlavní okno aplikace je implementováno pomocí třídy \c|MainWindow|. Toto je hlavní třída celého projektu.
Z~ní se teprve spouští inicializace pozadí aplikace včetně \c|Background|.

O~správné vykreslování tabulek změn stránek včetně napojení jejich ovládacích prvků se stará \c|PageViewer|.
\c|PageComparatorGUI| se stará o~okno zobrazené při porovnávání stránek a jeho napojení na \c|PageComparator|.
Okno historie změn zobrazuje \c|HistoryWindow|.

